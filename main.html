<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>SVG Costume Editor</title> <!-- Added site title -->
<link rel="icon" type="image/svg+xml" href="./assets/favicon.svg">
<link rel="stylesheet" href="./styles.css">
<link rel="icon" type="image/png" href="./assets/favicon.png"> <!-- Added site icon -->
</head>
<body>
    <div id="container">
        <input type="file" id="file-input" style="min-height:20px;">

        <div>
            <input type="text" id="style-name" placeholder="Style Name">
            <button id="save-style">Save Style</button>
            <select id="style-selector">
                <option>Select a style</option>
            </select>
            <button id="apply-style" style="margin-left: 10px;">Apply Style</button>
        </div>
        <div id="svg-container"></div>
        <div id="color-picker-container">
            <input type="color" id="color-picker">
            <input type="text" id="color-hex" placeholder="Hex code">
            <button id="add-color">Add Color</button>
        </div>
        <h2 id="color-bank-header">Color Bank</h2>
        <div id="color-bank">
        </div>
    </div>

    <script>
        document.getElementById('file-input').addEventListener('change', handleFileSelect);
        document.addEventListener('DOMContentLoaded', function() {
        document.getElementById('save-style').addEventListener('click', saveStyle);
        document.getElementById('apply-style').addEventListener('click', applyStyle);

        let savedStyles = {}; // Object to store styles by name

        function saveStyle() {
            const styleName = document.getElementById('style-name').value;
            if (!styleName) {
                alert("Please enter a style name.");
                return;
            }
            if (savedStyles[styleName]) {
                alert("Style name already exists.");
                return;
            }

            const svgElements = document.querySelectorAll('#svg-container path');
            const styleColors = Array.from(svgElements).map((elem, index) => ({
                index: index, // Assuming using index as identifier; replace as needed
                color: elem.style.fill
            }));

            savedStyles[styleName] = styleColors;
            updateStyleSelector(styleName);
            clearStyleInputs();
            alert("Style saved!");
        }

        function updateStyleSelector(newStyle) {
            const selector = document.getElementById('style-selector');
            const option = document.createElement('option');
            option.value = newStyle;
            option.textContent = newStyle;
            selector.appendChild(option);
        }

        function clearStyleInputs() {
            document.getElementById('style-name').value = '';
            document.getElementById('style-selector').value = 'Select a style';
        }

        function applyStyle() {
            const selectedStyle = document.getElementById('style-selector').value;
            if (selectedStyle === "Select a style" || !savedStyles[selectedStyle]) {
                alert("Please select a valid style.");
                return;
            }

            const styleColors = savedStyles[selectedStyle];
            const svgElements = document.querySelectorAll('#svg-container path');
            styleColors.forEach(style => {
                // Apply color to the correct element; adjust logic for element identification as needed
                if (svgElements[style.index]) {
                    svgElements[style.index].style.fill = style.color;
                }
            });
        }
    });


        function handleFileSelect(event) {
            const file = event.target.files[0];
            const reader = new FileReader();

            reader.onload = function (e) {
                const svgString = e.target.result;
                renderSVG(svgString);
            };

            reader.readAsText(file);
        }

        function renderSVG(svgString) {
            const svgContainer = document.getElementById('svg-container');
            svgContainer.innerHTML = svgString;

            const svg = svgContainer.querySelector('svg');

            // Set initial SVG dimensions
            svg.style.width = '100%';
            svg.style.height = '100%';

            const colorPicker = document.getElementById('color-picker');
            const colorHex = document.getElementById('color-hex');
            const colorBank = document.getElementById('color-bank');
            const svgElements = svgContainer.querySelectorAll('path'); // Adjust if other SVG elements are used

            for (let i = 0; i < svgElements.length; i++) {
                svgElements[i].addEventListener('click', function () {
                    this.style.fill = colorPicker.value;
                });
            }

            colorPicker.addEventListener('change', function () {
                colorHex.value = this.value;
            });

            colorHex.addEventListener('change', function () {
                colorPicker.value = this.value;
            });

            document.getElementById('add-color').addEventListener('click', function () {
                const color = colorHex.value;
                if (color) {
                    // Remove previous event listener to prevent adding multiple listeners
                    const colorOption = document.createElement('div');
                    colorOption.classList.add('color-option');
                    colorOption.style.backgroundColor = color;
                    colorOption.addEventListener('click', function () {
                        colorPicker.value = color; // Set the selected color of the color picker
                    });
                    colorBank.appendChild(colorOption);
                }
            });

            // Zooming functionality
            let zoomLevel = 1;
            svgContainer.addEventListener('wheel', function (event) {
                event.preventDefault();
                const zoomSpeed = 0.05;
                zoomLevel += event.deltaY * -zoomSpeed;
                zoomLevel = Math.max(0.1, zoomLevel);

                // Update SVG dimensions
                svg.style.width = `${100 * zoomLevel}%`;
                svg.style.height = `${100 * zoomLevel}%`;

                // Update scroll position based on zoom level
                const scrollLeft = svgContainer.scrollLeft;
                const scrollTop = svgContainer.scrollTop;
                const centerX = scrollLeft + svgContainer.offsetWidth / 2;
                const centerY = scrollTop + svgContainer.offsetHeight / 2;
                const newScrollLeft = (centerX * zoomLevel - svgContainer.offsetWidth / 2) / zoomLevel;
                const newScrollTop = (centerY * zoomLevel - svgContainer.offsetHeight / 2) / zoomLevel;
                svgContainer.scrollLeft = newScrollLeft;
                svgContainer.scrollTop = newScrollTop;
            });

            // Panning functionality
            let isPanning = false;
            let startCoords = { x: 0, y: 0 };
            svgContainer.addEventListener('mousedown', function (event) {
                isPanning = true;
                startCoords = { x: event.clientX, y: event.clientY };
                svgContainer.style.cursor = 'grabbing';
            });

            svgContainer.addEventListener('mousemove', function (event) {
                if (isPanning) {
                    const deltaX = event.clientX - startCoords.x;
                    const deltaY = event.clientY - startCoords.y;
                    svgContainer.scrollLeft -= deltaX;
                    svgContainer.scrollTop -= deltaY;
                    startCoords = { x: event.clientX, y: event.clientY };
                }
            });

            document.addEventListener('mouseup', function () { // Changed to listen on document
                isPanning = false;
                svgContainer.style.cursor = 'grab';
            });
        }
    </script>
</body>
</html>
